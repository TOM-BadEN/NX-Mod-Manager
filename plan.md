# Mod é¡µé¢è®¾è®¡

## é¡µé¢ç»“æ„

å¤ç”¨ MyFrame æ¡†æ¶ï¼Œå·¦å³åˆ†æ å¸ƒå±€ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MyFrame Header: æ¸¸æˆå + å›¾æ ‡                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  â”‚                              â”‚
â”‚  ModList         â”‚   ModDetail                  â”‚
â”‚  (å¡ç‰‡åˆ—è¡¨)      â”‚   (æ–‡æœ¬æ’ç‰ˆè¯¦æƒ…ï¼Œæš‚å ä½)       â”‚
â”‚                  â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                              â”‚
â”‚  â”‚ğŸ® mod-A    â”‚ â”‚                              â”‚
â”‚  â”‚  æ–‡ä»¶å¤¹ âœ… â”‚ â”‚                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                              â”‚
â”‚  â”‚ğŸ® mod-B    â”‚ â”‚                              â”‚
â”‚  â”‚  ZIP   âŒ  â”‚ â”‚                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                              â”‚
â”‚  â”‚ğŸ® mod-C    â”‚ â”‚                              â”‚
â”‚  â”‚  æ–‡ä»¶å¤¹ âœ… â”‚ â”‚                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                              â”‚
â”‚  â”‚ğŸ® xx.zip   â”‚ â”‚                              â”‚
â”‚  â”‚  ZIP   âŒ  â”‚ â”‚                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                              â”‚
â”‚                  â”‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  3/12                             Bè¿”å›  Aç¡®è®¤   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- Footer å·¦ä¸‹è§’ç´¢å¼•ï¼š`å½“å‰é€‰ä¸­ / æ€» mod æ•°`
- Footer å³ä¾§ï¼šæŒ‰é”®æç¤ºï¼ˆç”± MyFrame çš„ brls::Hints è‡ªåŠ¨ç®¡ç†ï¼‰

## ModItem ç»„ä»¶

### å¡ç‰‡å¤–å£³

å¤ç”¨ GameCard çš„è§†è§‰æ ·å¼ï¼š
- `backgroundColor="@theme/app/cardBg"`
- `cornerRadius="8"`, `highlightCornerRadius="8"`
- `shadowType="generic"`
- `focusable="true"`
- padding å››å‘¨ 20px

### å†…éƒ¨å¸ƒå±€ï¼ˆæ°´å¹³æ’åˆ—ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Icon  â”‚  modåç§°ï¼ˆ22å·ï¼‰      â”‚ å®‰è£…çŠ¶æ€  â”‚
â”‚ 48x48 â”‚  ç±»å‹ï¼ˆ17å·ï¼Œç°è‰²ï¼‰   â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  å·¦å¯¹é½     ä¸­é—´ grow=1          å³å¯¹é½
```

- **å·¦**ï¼šmod å›¾æ ‡ï¼ˆbrls::Imageï¼Œ48x48ï¼‰
- **ä¸­**ï¼šåç§° + ç±»å‹ï¼ˆbrls::Box çºµå‘ï¼Œåç§° fontSize=22ï¼Œç±»å‹ fontSize=17 ç°è‰²ï¼‰
- **å³**ï¼šå®‰è£…çŠ¶æ€æ–‡æœ¬

### å…¬å¼€æ¥å£

```cpp
void setMod(const std::string& name, const std::string& type, bool installed);
void clear();  // éšè—å¡ç‰‡
static brls::View* create();  // XML å·¥å‚
```

### æ–‡ä»¶

- `include/view/modItem.hpp`
- `src/view/modItem.cpp`
- `resources/xml/view/modItem.xml`

## ModList ç»„ä»¶

### è®¾è®¡æ¨¡å¼

å¤ç”¨ GridPage çš„å®ç°æ¨¡å¼ï¼š
- XML é¢„å®šä¹‰ 4 ä¸ª ModItem æ§½ä½ï¼ˆçºµå‘æ’åˆ—ï¼Œmargin é—´è·ï¼‰
- æ„é€ å‡½æ•°é€šè¿‡ getView è·å–æ§½ä½å¼•ç”¨
- å¤–éƒ¨æ•°æ®æŒ‡é’ˆ `std::vector<ModInfo>*`
- é€è¡Œæ»šåŠ¨é€šè¿‡ scrollOffset + refreshItems

### æ ¸å¿ƒæˆå‘˜

```cpp
class ModList : public brls::Box {
public:
    ModList();
    brls::View* getNextFocus(brls::FocusDirection direction, brls::View* currentView) override;

    void setModList(std::vector<ModInfo>& mods);
    void reloadData();
    void setIndexChangeCallback(std::function<void(int, int)> callback);

    static brls::View* create();

private:
    static constexpr int ITEMS_PER_PAGE = 4;

    ModItem* m_items[ITEMS_PER_PAGE];
    std::vector<ModInfo>* m_mods = nullptr;
    int m_scrollOffset = 0;
    IndexUpdate m_indexUpdate;

    void refreshItems();
    int findFocusedItemIndex();
    bool isItemVisible(int index);
};
```

### é€è¡Œæ»šåŠ¨é€»è¾‘ï¼ˆgetNextFocusï¼‰

```
items[i] æ˜¾ç¤º mods[m_scrollOffset + i]

DOWN:
  i < 3 ä¸” items[i+1] å¯è§ â†’ è¿”å› items[i+1]
  i == 3 ä¸” scrollOffset + 4 < total â†’ scrollOffset++, refreshItems(), è¿”å› items[3]
  å¦åˆ™ â†’ nullptrï¼ˆåˆ°åº•äº†ï¼‰

UP:
  i > 0 â†’ è¿”å› items[i-1]
  i == 0 ä¸” scrollOffset > 0 â†’ scrollOffset--, refreshItems(), è¿”å› items[0]
  å¦åˆ™ â†’ nullptrï¼ˆåˆ°é¡¶äº†ï¼‰
```

æ»šåŠ¨æ—¶ç„¦ç‚¹ä¸ç§»åŠ¨ï¼ˆåœç•™åœ¨è¾¹ç•Œæ§½ä½ï¼‰ï¼Œæ•°æ®åˆ·æ–°ã€‚ç”¨æˆ·æ„Ÿè§‰åˆ—è¡¨åœ¨æ»šåŠ¨ã€‚

### ç„¦ç‚¹å˜åŒ–å›è°ƒ

ç„¦ç‚¹å˜åŒ–æ—¶é€šçŸ¥å¤–éƒ¨ï¼ˆModActivityï¼‰å½“å‰é€‰ä¸­çš„å…¨å±€ç´¢å¼•å’Œæ€»æ•°ã€‚
ç”¨äºæ›´æ–°å³ä¾§ ModDetail + åº•éƒ¨ç´¢å¼•æ–‡æœ¬ã€‚
å¤ç”¨ IndexUpdate å·¥å…·ç±»ã€‚

### æ–‡ä»¶

- `include/view/modList.hpp`
- `src/view/modList.cpp`
- `resources/xml/view/modList.xml`

## ModDetail ç»„ä»¶ï¼ˆæš‚å ä½ï¼‰

- çº¯å±•ç¤ºï¼Œä¸å¯èšç„¦
- å„ç§ Label æ–‡æœ¬æ’ç‰ˆ
- ç”± ModList ç„¦ç‚¹å˜åŒ–é©±åŠ¨å†…å®¹æ›´æ–°
- åç»­è¡¥å……å…·ä½“å­—æ®µ

### æ–‡ä»¶

- `include/view/modDetail.hpp`
- `src/view/modDetail.cpp`
- `resources/xml/view/modDetail.xml`

## é¡µé¢ Activity

### ModActivity

- æ›¿ä»£ç°æœ‰ SecondActivity
- onContentAvailable ä¸­ï¼šæ‰«æ mod ç›®å½• â†’ è®¾ç½® ModList â†’ è®¾ç½®å›è°ƒ
- æ¥æ”¶ GameInfo æ•°æ®ï¼ˆä»ä¸»é¡µä¼ å…¥ï¼‰

### æ–‡ä»¶

- `include/activity/mod_activity.hpp`
- `src/activity/mod_activity.cpp`
- `resources/xml/activity/mod.xml`ï¼ˆå·¦å³åˆ†æ å¸ƒå±€ï¼‰

## æ•°æ®ç»“æ„

```cpp
struct ModInfo {
    std::string name;       // mod åï¼ˆç›®å½•åæˆ–æ–‡ä»¶åï¼‰
    std::string type;       // ç±»å‹æè¿°
    bool isInstalled;       // æ˜¯å¦å·²å®‰è£…
    std::string path;       // å®Œæ•´è·¯å¾„
};
```

### æ–‡ä»¶

- `include/common/modInfo.hpp`

## æ–°å¢æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | è¯´æ˜ |
|---|---|
| include/view/modItem.hpp | å•ä¸ªå¡ç‰‡ç»„ä»¶ |
| src/view/modItem.cpp | å¡ç‰‡ç»„ä»¶å®ç° |
| resources/xml/view/modItem.xml | å¡ç‰‡å¸ƒå±€ |
| include/view/modList.hpp | åˆ—è¡¨ç»„ä»¶ |
| src/view/modList.cpp | åˆ—è¡¨ç»„ä»¶å®ç° |
| resources/xml/view/modList.xml | åˆ—è¡¨å¸ƒå±€ï¼ˆ4 ä¸ª ModItemï¼‰ |
| include/view/modDetail.hpp | è¯¦æƒ…ç»„ä»¶ï¼ˆå ä½ï¼‰ |
| src/view/modDetail.cpp | è¯¦æƒ…ç»„ä»¶å®ç°ï¼ˆå ä½ï¼‰ |
| resources/xml/view/modDetail.xml | è¯¦æƒ…å¸ƒå±€ï¼ˆå ä½ï¼‰ |
| include/activity/mod_activity.hpp | Mod é¡µé¢ Activity |
| src/activity/mod_activity.cpp | Mod é¡µé¢å®ç° |
| resources/xml/activity/mod.xml | é¡µé¢å¸ƒå±€ï¼ˆå·¦å³åˆ†æ ï¼‰ |
| include/common/modInfo.hpp | ModInfo æ•°æ®ç»“æ„ |

## å¾…ç¡®è®¤ï¼ˆåç»­ï¼‰

1. mod å¯ç”¨/ç¦ç”¨åˆ¤æ–­æœºåˆ¶
2. ç”¨æˆ·å¯æ‰§è¡Œçš„æ“ä½œï¼ˆå¯ç”¨/ç¦ç”¨/åˆ é™¤ç­‰ï¼‰
3. GameCard ç‚¹å‡»è·³è½¬åˆ° Mod é¡µé¢çš„å®ç°
4. ModDetail å…·ä½“æ˜¾ç¤ºå“ªäº›å­—æ®µ
5. Mod ç±»å‹å›¾æ ‡èµ„æº
6. L/R ç¿»é¡µæ˜¯å¦éœ€è¦
